<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>旅行助手 | 行程規劃與記賬</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCkUOdZ5y7hMm0yrcCQoCvLwzdM6M8s5qk&libraries=places&callback=initMap" async defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 自定義滾動條樣式 */
        .scrollbar-thin::-webkit-scrollbar {
            width: 3px;
        }
        .scrollbar-thin::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: rgba(255, 182, 193, 0.6);
            border-radius: 10px;
        }
        
        /* 防止文字選取 */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* 允許輸入框文字選取 */
        input, textarea, select {
            -webkit-user-select: text;
            user-select: text;
        }
        
        /* 動畫效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-10px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        /* 卡片陰影效果 */
        .card-shadow {
            box-shadow: 0 4px 15px rgba(255, 182, 193, 0.15);
        }
        
        /* 底部導航陰影 */
        .nav-shadow {
            box-shadow: 0 -4px 20px rgba(255, 182, 193, 0.1);
        }
        
        /* 按鈕懸停效果 */
        .btn-hover {
            transition: all 0.2s ease;
        }
        
        .btn-hover:hover {
            transform: translateY(-2px);
        }
        
        /* Google 地圖容器 */
        #map {
            width: 100%;
            height: 100%;
        }
        
        .map-container {
            position: relative;
            width: 100%;
            height: 300px;
            border-radius: 16px;
            overflow: hidden;
        }
        
        /* 自定義日期選擇器樣式 */
        input[type="date"]::-webkit-calendar-picker-indicator {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="%23FF6B9D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></rect></svg>');
            cursor: pointer;
        }
        
        /* 貨幣選擇器樣式 */
        .currency-flag {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* 搜尋輸入框樣式 */
        .search-container {
            position: relative;
        }
        
        .search-input {
            padding-left: 40px !important;
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #FF6B9D;
        }
    </style>
</head>
<body class="font-sans bg-gradient-to-b from-pink-50 to-white">
    <div id="app" class="min-h-screen max-w-md mx-auto">
        <!-- 頂部標題欄 - 粉嫩漸層 -->
        <header class="pt-5 px-4 pb-3 bg-gradient-to-r from-pink-100 to-purple-100">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-pink-300 to-purple-300 flex items-center justify-center shadow-md mr-3">
                        <i class="fas fa-suitcase-rolling text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-pink-800">旅行助手</h1>
                        <p class="text-sm text-pink-600 mt-1">{{ currentDate }}</p>
                    </div>
                </div>
                <button @click="showSettings = !showSettings" class="w-10 h-10 rounded-full bg-white flex items-center justify-center shadow-sm hover:shadow-md transition-shadow">
                    <i class="fas fa-cog text-pink-500"></i>
                </button>
            </div>
        </header>
        
        <!-- 功能選項卡 - 粉嫩設計 -->
        <div class="flex px-3 pt-4 pb-3">
            <button 
                v-for="tab in tabs" 
                :key="tab.id"
                @click="activeTab = tab.id"
                class="flex-1 py-3 px-1 rounded-2xl text-sm font-medium transition mx-1 btn-hover card-shadow"
                :class="activeTab === tab.id 
                    ? 'text-white' 
                    : 'text-pink-700 bg-white hover:bg-pink-50'"
                :style="activeTab === tab.id ? {background: `linear-gradient(135deg, ${tab.color}, ${tab.color2})`} : {}"
            >
                <i :class="tab.icon" class="mr-1 text-base"></i>
                {{ tab.name }}
            </button>
        </div>

        <!-- 主內容區域 -->
        <main class="p-4 pb-24 overflow-y-auto scrollbar-thin" style="min-height: calc(100vh - 160px);">
            <!-- 行程表 -->
            <section v-if="activeTab === 'itinerary'" class="space-y-4 fade-in">
                <div class="flex items-center justify-between mb-2">
                    <h2 class="text-lg font-bold text-pink-800">行程規劃</h2>
                    <button @click="addNewItinerary" class="w-10 h-10 rounded-full flex items-center justify-center shadow-lg btn-hover" style="background: linear-gradient(135deg, #FF9EAA, #FF6B9D)">
                        <i class="fas fa-plus text-white"></i>
                    </button>
                </div>
                
                <!-- 日期篩選 -->
                <div class="mb-4">
                    <div class="flex items-center space-x-2 overflow-x-auto pb-2">
                        <button 
                            v-for="date in availableDates" 
                            :key="date"
                            @click="selectedDate = date"
                            class="px-4 py-2 rounded-xl whitespace-nowrap transition"
                            :class="selectedDate === date 
                                ? 'text-white shadow-md' 
                                : 'text-pink-700 bg-white hover:bg-pink-50'"
                            :style="selectedDate === date ? {background: `linear-gradient(135deg, #FF9EAA, #FF6B9D)`} : {}"
                        >
                            {{ formatDateForDisplay(date) }}
                        </button>
                    </div>
                </div>
                
                <!-- 行程卡片 - 粉嫩設計 -->
                <div v-for="(item, index) in filteredItinerary" :key="item.id" class="rounded-2xl p-4 mb-3 card-shadow bg-white slide-in" :style="{animationDelay: `${index * 0.05}s`}">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-start justify-between">
                                <div>
                                    <h3 class="font-bold text-gray-800 text-base">{{ item.title }}</h3>
                                    <div class="flex items-center mt-1">
                                        <p class="text-xs text-pink-500 mr-3">
                                            <i class="far fa-clock mr-1"></i>{{ item.time }}
                                        </p>
                                        <p class="text-xs text-purple-500">
                                            <i class="far fa-calendar mr-1"></i>{{ formatDateForDisplay(item.date) }}
                                        </p>
                                    </div>
                                </div>
                                <button @click="removeItinerary(item.id)" class="text-gray-400 hover:text-red-400 ml-2 transition">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <p class="text-sm text-gray-600 mt-2 pl-1 border-l-2" :style="{borderColor: typeColors[item.type]}">{{ item.description }}</p>
                        </div>
                    </div>
                    <div class="flex items-center mt-3 pt-3 border-t border-pink-100">
                        <span class="text-xs px-3 py-1.5 rounded-full mr-2 font-medium shadow-sm" :style="{backgroundColor: typeColors[item.type], color: '#FFF'}">
                            {{ item.type }}
                        </span>
                        <span class="text-xs text-pink-600">
                            <i class="fas fa-map-marker-alt mr-1 text-xs"></i>{{ item.location }}
                        </span>
                    </div>
                </div>
                
                <div v-if="filteredItinerary.length === 0" class="text-center py-10">
                    <div class="w-20 h-20 rounded-full bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center mx-auto mb-4 card-shadow">
                        <i class="fas fa-calendar-plus text-2xl" style="color: #FF9EAA"></i>
                    </div>
                    <p class="text-gray-500">沒有這一天的行程安排</p>
                    <p class="text-sm text-gray-400 mt-1">點擊 + 按鈕新增行程</p>
                </div>
            </section>

            <!-- 地圖 -->
            <section v-if="activeTab === 'map'" class="space-y-4 fade-in">
                <h2 class="text-lg font-bold text-pink-800 mb-2">地圖</h2>
                
                <div class="rounded-2xl overflow-hidden card-shadow map-container">
                    <div id="map" class="w-full h-full"></div>
                </div>
                
                <!-- 搜尋功能 -->
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input 
                        v-model="searchQuery" 
                        @keyup.enter="searchLocation" 
                        type="text" 
                        placeholder="搜尋地點 (如: 台北101、鼎泰豐)" 
                        class="w-full p-3 pl-10 border border-pink-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent search-input"
                    >
                </div>
                
                <div class="grid grid-cols-2 gap-3 mt-4">
                    <button @click="searchLocation" class="p-4 rounded-xl text-center card-shadow btn-hover bg-white hover:bg-pink-50 transition">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-100 to-pink-100 flex items-center justify-center mx-auto mb-2">
                            <i class="fas fa-search" style="color: #FF6B9D"></i>
                        </div>
                        <p class="text-gray-700 text-xs font-medium">搜尋地點</p>
                    </button>
                    <button @click="showRoutePanel = true" class="p-4 rounded-xl text-center card-shadow btn-hover bg-white hover:bg-pink-50 transition">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-100 to-pink-100 flex items-center justify-center mx-auto mb-2">
                            <i class="fas fa-directions" style="color: #FF6B9D"></i>
                        </div>
                        <p class="text-gray-700 text-xs font-medium">路線規劃</p>
                    </button>
                </div>
                
                <div class="rounded-2xl p-4 mt-4 card-shadow bg-white">
                    <h3 class="font-bold text-gray-800 mb-3 text-sm">最近搜尋</h3>
                    <div class="space-y-3">
                        <div v-for="location in recentLocations" :key="location" class="flex items-center text-sm text-gray-700 p-2 rounded-lg hover:bg-pink-50 transition cursor-pointer" @click="searchRecentLocation(location)">
                            <div class="w-8 h-8 rounded-full bg-pink-100 flex items-center justify-center mr-3">
                                <i class="fas fa-map-pin text-xs" style="color: #FF6B9D"></i>
                            </div>
                            <span>{{ location }}</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 記賬功能 -->
            <section v-if="activeTab === 'expense'" class="space-y-4 fade-in">
                <div class="flex items-center justify-between mb-2">
                    <h2 class="text-lg font-bold text-pink-800">旅行記錄</h2>
                    <div class="flex items-center space-x-3">
                        <div class="relative">
                            <select v-model="selectedCurrency" @change="updateCurrency" class="appearance-none bg-white border border-pink-200 rounded-xl px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent pr-10">
                                <option v-for="currency in currencies" :key="currency.code" :value="currency.code">
                                    {{ currency.symbol }} {{ currency.code }}
                                </option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-pink-500">
                                <i class="fas fa-chevron-down text-xs"></i>
                            </div>
                        </div>
                        <button @click="showAddExpense = true" class="w-10 h-10 rounded-full flex items-center justify-center shadow-lg btn-hover" style="background: linear-gradient(135deg, #9D7BFF, #C973FF)">
                            <i class="fas fa-plus text-white"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 支出統計 -->
                <div class="rounded-2xl p-4 card-shadow" style="background: linear-gradient(135deg, #FFE4E9, #FFD6E0)">
                    <h3 class="font-bold text-gray-800 mb-3 text-sm">支出統計</h3>
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <p class="text-xs text-pink-600">總支出</p>
                            <p class="text-2xl font-bold text-gray-800">{{ currencySymbol }}{{ totalExpenses }}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xs text-pink-600">項目數</p>
                            <p class="text-2xl font-bold" style="color: #FF6B9D">{{ expenses.length }}</p>
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <div v-for="category in expenseCategories" :key="category.name" class="flex items-center justify-between text-xs">
                            <div class="flex items-center">
                                <div class="w-3 h-3 rounded-full mr-2 shadow-sm" :style="{backgroundColor: category.color}"></div>
                                <span class="text-gray-700">{{ category.name }}</span>
                            </div>
                            <span class="font-bold" :style="{color: category.color}">{{ currencySymbol }}{{ category.amount }}</span>
                        </div>
                    </div>
                </div>
                
                <!-- 支出記錄 -->
                <h3 class="font-bold text-gray-800 mt-5 mb-3 text-sm">近期支出</h3>
                <div v-for="(item, index) in expenses" :key="item.id" class="rounded-xl p-3 mb-2 card-shadow bg-white slide-in" :style="{animationDelay: `${index * 0.05}s`, borderLeft: `4px solid ${categoryColor(item.category)}`}">
                    <div class="flex justify-between items-center">
                        <div>
                            <h4 class="font-bold text-gray-800 text-sm">{{ item.title }}</h4>
                            <p class="text-xs text-pink-500">{{ formatDateForDisplay(item.date) }} • {{ item.category }}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-gray-800 text-lg">{{ currencySymbol }}{{ item.amount }}</p>
                            <button @click="removeExpense(item.id)" class="text-xs text-gray-400 hover:text-red-400 transition">
                                <i class="fas fa-trash-alt text-xs"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div v-if="expenses.length === 0" class="text-center py-10">
                    <div class="w-20 h-20 rounded-full bg-gradient-to-br from-purple-100 to-pink-100 flex items-center justify-center mx-auto mb-4 card-shadow">
                        <i class="fas fa-receipt text-2xl" style="color: #C973FF"></i>
                    </div>
                    <p class="text-gray-500">還沒有支出記錄</p>
                    <p class="text-sm text-gray-400 mt-1">點擊 + 按鈕新增第一筆支出</p>
                </div>
            </section>

            <!-- 購物清單 -->
            <section v-if="activeTab === 'shopping'" class="space-y-4 fade-in">
                <div class="flex items-center justify-between mb-2">
                    <h2 class="text-lg font-bold text-pink-800">購物清單</h2>
                    <div class="flex space-x-2">
                        <button @click="showAddItem = true" class="w-10 h-10 rounded-full flex items-center justify-center shadow-lg btn-hover" style="background: linear-gradient(135deg, #7BCAFF, #6BA8FF)">
                            <i class="fas fa-plus text-white"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 購物統計 -->
                <div class="rounded-2xl p-4 card-shadow" style="background: linear-gradient(135deg, #E4F7FF, #D6F0FF)">
                    <div class="flex justify-between items-center">
                        <div class="text-center">
                            <p class="text-xs text-blue-600">總項目</p>
                            <p class="text-2xl font-bold text-gray-800">{{ shoppingItems.length }}</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-blue-600">已完成</p>
                            <p class="text-2xl font-bold" style="color: #6BA8FF">{{ completedItems }}</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-blue-600">未完成</p>
                            <p class="text-2xl font-bold text-gray-800">{{ shoppingItems.length - completedItems }}</p>
                        </div>
                    </div>
                </div>
                
                <!-- 購物項目 -->
                <h3 class="font-bold text-gray-800 mt-5 mb-3 text-sm">購物項目</h3>
                <div v-for="(item, index) in shoppingItems" :key="item.id" class="rounded-xl p-3 mb-2 card-shadow bg-white slide-in" :style="{animationDelay: `${index * 0.05}s`}">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center flex-1">
                            <button @click="toggleItemComplete(item.id)" class="mr-3">
                                <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center btn-hover" :style="{borderColor: item.completed ? '#6BA8FF' : '#E2E8F0'}">
                                    <i v-if="item.completed" class="fas fa-check text-xs" style="color: #6BA8FF"></i>
                                </div>
                            </button>
                            <div class="flex-1">
                                <h4 class="font-bold text-gray-800 text-sm" :class="{'line-through text-gray-400': item.completed}">{{ item.name }}</h4>
                                <div class="flex items-center mt-1">
                                    <p class="text-xs text-blue-500 mr-3">
                                        {{ item.category }} • {{ item.store || '未指定商店' }}
                                    </p>
                                    <p class="text-xs font-bold text-gray-700">
                                        {{ currencySymbol }}{{ item.price || '--' }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div v-if="shoppingItems.length === 0" class="text-center py-10">
                    <div class="w-20 h-20 rounded-full bg-gradient-to-br from-blue-100 to-cyan-100 flex items-center justify-center mx-auto mb-4 card-shadow">
                        <i class="fas fa-shopping-cart text-2xl" style="color: #6BA8FF"></i>
                    </div>
                    <p class="text-gray-500">購物清單是空的</p>
                    <p class="text-sm text-gray-400 mt-1">點擊 + 按鈕新增第一個購物項目</p>
                </div>
            </section>
        </main>

        <!-- 底部導航 - 粉嫩設計 -->
        <footer class="fixed bottom-0 w-full max-w-md p-3 nav-shadow bg-white rounded-t-3xl">
            <div class="flex justify-around">
                <button 
                    v-for="tab in tabs" 
                    :key="tab.id"
                    @click="activeTab = tab.id"
                    class="flex flex-col items-center p-2 rounded-xl transition w-16 btn-hover"
                    :class="activeTab === tab.id ? 'text-pink-600' : 'text-gray-400'"
                >
                    <div class="w-10 h-10 rounded-full flex items-center justify-center mb-1" :style="{background: activeTab === tab.id ? `linear-gradient(135deg, ${tab.color}, ${tab.color2})` : '#F8F9FA'}">
                        <i :class="tab.icon" class="text-lg" :style="{color: activeTab === tab.id ? 'white' : '#9CA3AF'}"></i>
                    </div>
                    <span class="text-xs font-medium">{{ tab.name }}</span>
                </button>
            </div>
        </footer>

        <!-- 設定面板 -->
        <div v-if="showSettings" class="fixed inset-0 bg-black bg-opacity-40 flex items-end justify-center z-50 p-4 backdrop-blur-sm" @click="showSettings = false">
            <div class="bg-white rounded-t-2xl w-full max-w-md p-5 card-shadow" @click.stop>
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-pink-800">設定</h3>
                    <button @click="showSettings = false" class="text-gray-500 hover:text-pink-600 transition">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <h4 class="font-medium text-gray-800 mb-2">預設貨幣</h4>
                        <div class="grid grid-cols-3 gap-2">
                            <button 
                                v-for="currency in currencies" 
                                :key="currency.code"
                                @click="selectCurrency(currency.code)"
                                class="p-3 rounded-xl border transition text-center"
                                :class="selectedCurrency === currency.code 
                                    ? 'border-pink-500 bg-pink-50 text-pink-700' 
                                    : 'border-gray-200 hover:border-pink-300'"
                            >
                                <div class="font-bold mb-1">{{ currency.symbol }}</div>
                                <div class="text-xs">{{ currency.code }}</div>
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-gray-800 mb-2">主題顏色</h4>
                        <div class="flex space-x-2">
                            <button 
                                v-for="theme in themes" 
                                :key="theme.name"
                                @click="applyTheme(theme)"
                                class="w-10 h-10 rounded-full shadow-sm"
                                :style="{background: `linear-gradient(135deg, ${theme.color1}, ${theme.color2})`}"
                                :title="theme.name"
                            ></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 新增行程模態框 -->
        <div v-if="showAddItinerary" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
            <div class="bg-white rounded-2xl w-full max-w-md p-5 card-shadow" style="max-height: 90vh; overflow-y: auto;">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-pink-800">新增行程</h3>
                    <button @click="showAddItinerary = false" class="text-gray-500 hover:text-pink-600 transition">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">行程名稱</label>
                        <input v-model="newItinerary.title" type="text" class="w-full p-3 border border-pink-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">日期</label>
                            <input v-model="newItinerary.date" type="date" class="w-full p-3 border border-pink-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">時間</label>
                            <input v-model="newItinerary.time" type="time" class="w-full p-3 border border-pink-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">描述</label>
                        <textarea v-model="newItinerary.description" rows="2" class="w-full p-3 border border-pink-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">類型</label>
                            <select v-model="newItinerary.type" class="w-full p-3 border border-pink-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                                <option value="景點">景點</option>
                                <option value="餐廳">餐廳</option>
                                <option value="住宿">住宿</option>
                                <option value="交通">交通</option>
                                <option value="購物">購物</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">地點</label>
                            <input v-model="newItinerary.location" type="text" class="w-full p-3 border border-pink-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button @click="showAddItinerary = false" class="px-4 py-2 rounded-xl text-gray-700 hover:bg-pink-50 transition text-sm">
                        取消
                    </button>
                    <button @click="saveItinerary" class="px-4 py-2 rounded-xl text-white font-medium text-sm shadow-md" style="background: linear-gradient(135deg, #FF9EAA, #FF6B9D)">
                        儲存行程
                    </button>
                </div>
            </div>
        </div>

        <!-- 新增支出模態框 -->
        <div v-if="showAddExpense" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
            <div class="bg-white rounded-2xl w-full max-w-md p-5 card-shadow">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-pink-800">新增支出</h3>
                    <button @click="showAddExpense = false" class="text-gray-500 hover:text-pink-600 transition">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">項目名稱</label>
                        <input v-model="newExpense.title" type="text" class="w-full p-3 border border-pink-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">金額</label>
                            <div class="flex">
                                <span class="p-3 border border-r-0 border-pink-200 rounded-l-xl bg-pink-50 text-pink-700 font-medium">{{ currencySymbol }}</span>
                                <input v-model="newExpense.amount" type="number" class="w-full p-3 border border-pink-200 rounded-r-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">類別</label>
                            <select v-model="newExpense.category" class="w-full p-3 border border-pink-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                                <option value="飲食">飲食</option>
                                <option value="住宿">住宿</option>
                                <option value="交通">交通</option>
                                <option value="購物">購物</option>
                                <option value="娛樂">娛樂</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">日期</label>
                        <input v-model="newExpense.date" type="date" class="w-full p-3 border border-pink-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button @click="showAddExpense = false" class="px-4 py-2 rounded-xl text-gray-700 hover:bg-pink-50 transition text-sm">
                        取消
                    </button>
                    <button @click="saveExpense" class="px-4 py-2 rounded-xl text-white font-medium text-sm shadow-md" style="background: linear-gradient(135deg, #9D7BFF, #C973FF)">
                        儲存支出
                    </button>
                </div>
            </div>
        </div>

        <!-- 新增購物項目模態框 -->
        <div v-if="showAddItem" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
            <div class="bg-white rounded-2xl w-full max-w-md p-5 card-shadow">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-pink-800">新增購物項目</h3>
                    <button @click="showAddItem = false" class="text-gray-500 hover:text-pink-600 transition">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">項目名稱</label>
                        <input v-model="newItem.name" type="text" class="w-full p-3 border border-pink-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">類別</label>
                            <select v-model="newItem.category" class="w-full p-3 border border-pink-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                                <option value="食品">食品</option>
                                <option value="衣物">衣物</option>
                                <option value="紀念品">紀念品</option>
                                <option value="日用品">日用品</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">價格</label>
                            <div class="flex">
                                <span class="p-3 border border-r-0 border-pink-200 rounded-l-xl bg-pink-50 text-pink-700 font-medium">{{ currencySymbol }}</span>
                                <input v-model="newItem.price" type="number" class="w-full p-3 border border-pink-200 rounded-r-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">商店</label>
                        <input v-model="newItem.store" type="text" class="w-full p-3 border border-pink-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button @click="showAddItem = false" class="px-4 py-2 rounded-xl text-gray-700 hover:bg-pink-50 transition text-sm">
                        取消
                    </button>
                    <button @click="saveShoppingItem" class="px-4 py-2 rounded-xl text-white font-medium text-sm shadow-md" style="background: linear-gradient(135deg, #7BCAFF, #6BA8FF)">
                        儲存項目
                    </button>
                </div>
            </div>
        </div>

        <!-- 路線規劃模態框 -->
        <div v-if="showRoutePanel" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
            <div class="bg-white rounded-2xl w-full max-w-md p-5 card-shadow">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-pink-800">路線規劃</h3>
                    <button @click="showRoutePanel = false" class="text-gray-500 hover:text-pink-600 transition">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">起點</label>
                        <input v-model="routeStart" type="text" class="w-full p-3 border border-pink-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent" placeholder="例如: 台北車站">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">終點</label>
                        <input v-model="routeEnd" type="text" class="w-full p-3 border border-pink-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent" placeholder="例如: 台北101">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">交通方式</label>
                        <div class="grid grid-cols-3 gap-2">
                            <button 
                                v-for="mode in travelModes" 
                                :key="mode.value"
                                @click="routeMode = mode.value"
                                class="p-3 rounded-xl border transition text-center"
                                :class="routeMode === mode.value 
                                    ? 'border-pink-500 bg-pink-50 text-pink-700' 
                                    : 'border-gray-200 hover:border-pink-300'"
                            >
                                <i :class="mode.icon" class="mb-1"></i>
                                <div class="text-xs">{{ mode.name }}</div>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button @click="showRoutePanel = false" class="px-4 py-2 rounded-xl text-gray-700 hover:bg-pink-50 transition text-sm">
                        取消
                    </button>
                    <button @click="planRoute" class="px-4 py-2 rounded-xl text-white font-medium text-sm shadow-md" style="background: linear-gradient(135deg, #A78BFA, #C973FF)">
                        規劃路線
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                const today = new Date().toISOString().slice(0, 10);
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowStr = tomorrow.toISOString().slice(0, 10);
                
                return {
                    currentDate: new Date().toLocaleDateString('zh-TW', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric',
                        weekday: 'long'
                    }),
                    tabs: [
                        { id: 'itinerary', name: '行程', icon: 'fas fa-calendar-alt', color: '#FF9EAA', color2: '#FF6B9D' },
                        { id: 'map', name: '地圖', icon: 'fas fa-map', color: '#A78BFA', color2: '#C973FF' },
                        { id: 'expense', name: '記錄', icon: 'fas fa-wallet', color: '#9D7BFF', color2: '#C973FF' },
                        { id: 'shopping', name: '購物清單', icon: 'fas fa-shopping-cart', color: '#7BCAFF', color2: '#6BA8FF' }
                    ],
                    activeTab: 'itinerary',
                    
                    // 行程相關
                    selectedDate: today,
                    itinerary: [
                        { id: 1, title: '抵達桃園機場', date: today, time: '09:00', description: '搭乘機場捷運前往台北車站', type: '交通', location: '桃園機場' },
                        { id: 2, title: '台北101觀景台', date: today, time: '11:00', description: '欣賞台北市全景', type: '景點', location: '台北101' },
                        { id: 3, title: '鼎泰豐午餐', date: today, time: '13:00', description: '品嚐著名小籠包', type: '餐廳', location: '信義區' },
                        { id: 4, title: '故宮博物院', date: tomorrowStr, time: '10:00', description: '參觀中華文物', type: '景點', location: '士林區' }
                    ],
                    showAddItinerary: false,
                    newItinerary: {
                        title: '',
                        date: today,
                        time: '',
                        description: '',
                        type: '景點',
                        location: ''
                    },
                    
                    // 行程類型顏色
                    typeColors: {
                        '景點': '#FF9EAA',
                        '餐廳': '#A78BFA',
                        '住宿': '#7BCAFF',
                        '交通': '#6BA8FF',
                        '購物': '#9D7BFF'
                    },
                    
                    // 地圖相關
                    map: null,
                    searchQuery: '',
                    recentLocations: ['台北101觀景台', '鼎泰豐信義店', '桃園機場', '故宮博物院'],
                    showRoutePanel: false,
                    routeStart: '',
                    routeEnd: '',
                    routeMode: 'DRIVING',
                    travelModes: [
                        { value: 'DRIVING', name: '開車', icon: 'fas fa-car' },
                        { value: 'WALKING', name: '步行', icon: 'fas fa-walking' },
                        { value: 'TRANSIT', name: '大眾運輸', icon: 'fas fa-bus' }
                    ],
                    
                    // 貨幣相關
                    currencies: [
                        { code: 'TWD', symbol: 'NT$', name: '新台幣' },
                        { code: 'HKD', symbol: 'HK$', name: '港幣' },
                        { code: 'CNY', symbol: '¥', name: '人民幣' },
                        { code: 'USD', symbol: '$', name: '美元' },
                        { code: 'JPY', symbol: '¥', name: '日圓' },
                        { code: 'EUR', symbol: '€', name: '歐元' }
                    ],
                    selectedCurrency: 'TWD',
                    currencySymbol: 'NT$',
                    
                    // 記賬相關
                    expenses: [
                        { id: 1, title: '早餐', amount: 150, category: '飲食', date: today },
                        { id: 2, title: '捷運票', amount: 50, category: '交通', date: today },
                        { id: 3, title: '101門票', amount: 600, category: '娛樂', date: today }
                    ],
                    expenseCategories: [
                        { name: '飲食', amount: 150, color: '#FF9EAA' },
                        { name: '住宿', amount: 0, color: '#A78BFA' },
                        { name: '交通', amount: 50, color: '#7BCAFF' },
                        { name: '購物', amount: 0, color: '#9D7BFF' },
                        { name: '娛樂', amount: 600, color: '#FF6B9D' }
                    ],
                    showAddExpense: false,
                    newExpense: {
                        title: '',
                        amount: 0,
                        category: '飲食',
                        date: today
                    },
                    
                    // 購物清單相關
                    shoppingItems: [
                        { id: 1, name: '鳳梨酥', category: '食品', price: 350, store: '佳德糕餅', completed: true },
                        { id: 2, name: '茶葉', category: '食品', price: 800, store: '天仁茗茶', completed: false },
                        { id: 3, name: '台北101鑰匙圈', category: '紀念品', price: 150, store: '台北101', completed: false }
                    ],
                    showAddItem: false,
                    newItem: {
                        name: '',
                        category: '食品',
                        price: 0,
                        store: ''
                    },
                    
                    // 設定相關
                    showSettings: false,
                    themes: [
                        { name: '粉紅', color1: '#FF9EAA', color2: '#FF6B9D' },
                        { name: '紫色', color1: '#A78BFA', color2: '#C973FF' },
                        { name: '藍色', color1: '#7BCAFF', color2: '#6BA8FF' },
                        { name: '綠色', color1: '#34D399', color2: '#10B981' }
                    ]
                };
            },
            computed: {
                availableDates() {
                    const dates = [...new Set(this.itinerary.map(item => item.date))];
                    dates.sort();
                    return dates;
                },
                filteredItinerary() {
                    return this.itinerary
                        .filter(item => item.date === this.selectedDate)
                        .sort((a, b) => a.time.localeCompare(b.time));
                },
                totalExpenses() {
                    return this.expenses.reduce((sum, expense) => sum + parseInt(expense.amount), 0);
                },
                completedItems() {
                    return this.shoppingItems.filter(item => item.completed).length;
                }
            },
            methods: {
                getTodayDate() {
                    const today = new Date();
                    return today.toISOString().slice(0, 10);
                },
                
                formatDateForDisplay(dateStr) {
                    const date = new Date(dateStr);
                    const today = new Date();
                    const tomorrow = new Date();
                    tomorrow.setDate(today.getDate() + 1);
                    
                    if (date.toDateString() === today.toDateString()) {
                        return '今天';
                    } else if (date.toDateString() === tomorrow.toDateString()) {
                        return '明天';
                    } else {
                        return `${date.getMonth() + 1}月${date.getDate()}日`;
                    }
                },
                
                formatTimeForDisplay(timeStr) {
                    if (!timeStr) return '';
                    const [hours, minutes] = timeStr.split(':');
                    const hour = parseInt(hours);
                    if (hour < 12) {
                        return `${hour}:${minutes} AM`;
                    } else if (hour === 12) {
                        return `12:${minutes} PM`;
                    } else {
                        return `${hour - 12}:${minutes} PM`;
                    }
                },
                
                categoryColor(category) {
                    const colors = {
                        '飲食': '#FF9EAA',
                        '住宿': '#A78BFA',
                        '交通': '#7BCAFF',
                        '購物': '#9D7BFF',
                        '娛樂': '#FF6B9D'
                    };
                    return colors[category] || '#CBD5E0';
                },
                
                // 行程表方法
                addNewItinerary() {
                    this.showAddItinerary = true;
                    this.newItinerary = {
                        title: '',
                        date: this.selectedDate,
                        time: '',
                        description: '',
                        type: '景點',
                        location: ''
                    };
                },
                saveItinerary() {
                    const newId = this.itinerary.length > 0 ? Math.max(...this.itinerary.map(i => i.id)) + 1 : 1;
                    this.itinerary.push({
                        id: newId,
                        ...this.newItinerary
                    });
                    this.showAddItinerary = false;
                },
                removeItinerary(id) {
                    this.itinerary = this.itinerary.filter(item => item.id !== id);
                },
                
                // 地圖方法
                initMap() {
                    // 初始化地圖，以台北為中心
                    const mapElement = document.getElementById('map');
                    if (mapElement) {
                        this.map = new google.maps.Map(mapElement, {
                            center: { lat: 25.0330, lng: 121.5654 }, // 台北101座標
                            zoom: 15,
                            styles: [
                                {
                                    featureType: "poi",
                                    elementType: "labels",
                                    stylers: [{ visibility: "off" }]
                                }
                            ]
                        });
                        
                        // 添加標記
                        const marker = new google.maps.Marker({
                            position: { lat: 25.0330, lng: 121.5654 },
                            map: this.map,
                            title: '台北101',
                            icon: {
                                url: 'https://maps.google.com/mapfiles/ms/icons/pink-dot.png'
                            }
                        });
                    }
                },
                
                searchLocation() {
                    if (!this.searchQuery.trim()) return;
                    
                    // 模擬搜尋結果
                    const geocoder = new google.maps.Geocoder();
                    geocoder.geocode({ address: this.searchQuery }, (results, status) => {
                        if (status === 'OK' && results[0]) {
                            this.map.setCenter(results[0].geometry.location);
                            new google.maps.Marker({
                                map: this.map,
                                position: results[0].geometry.location,
                                title: this.searchQuery,
                                icon: {
                                    url: 'https://maps.google.com/mapfiles/ms/icons/pink-dot.png'
                                }
                            });
                            
                            // 添加到最近搜尋
                            if (!this.recentLocations.includes(this.searchQuery)) {
                                this.recentLocations.unshift(this.searchQuery);
                                if (this.recentLocations.length > 5) {
                                    this.recentLocations.pop();
                                }
                            }
                            
                            this.searchQuery = '';
                        } else {
                            alert('找不到這個地點: ' + this.searchQuery);
                        }
                    });
                },
                
                searchRecentLocation(location) {
                    this.searchQuery = location;
                    this.searchLocation();
                },
                
                planRoute() {
                    if (!this.routeStart || !this.routeEnd) {
                        alert('請輸入起點和終點');
                        return;
                    }
                    
                    // 這裡應該使用Google Directions API，但需要付費API金鑰
                    // 這裡僅顯示訊息
                    alert(`已規劃從 ${this.routeStart} 到 ${this.routeEnd} 的路線\n交通方式: ${this.travelModes.find(m => m.value === this.routeMode).name}`);
                    this.showRoutePanel = false;
                    this.routeStart = '';
                    this.routeEnd = '';
                },
                
                // 貨幣方法
                selectCurrency(code) {
                    this.selectedCurrency = code;
                    const currency = this.currencies.find(c => c.code === code);
                    this.currencySymbol = currency.symbol;
                    this.showSettings = false;
                },
                
                updateCurrency() {
                    const currency = this.currencies.find(c => c.code === this.selectedCurrency);
                    this.currencySymbol = currency.symbol;
                },
                
                // 記賬方法
                saveExpense() {
                    const newId = this.expenses.length > 0 ? Math.max(...this.expenses.map(e => e.id)) + 1 : 1;
                    this.expenses.push({
                        id: newId,
                        ...this.newExpense
                    });
                    
                    // 更新類別統計
                    this.updateExpenseCategories();
                    this.showAddExpense = false;
                },
                removeExpense(id) {
                    this.expenses = this.expenses.filter(item => item.id !== id);
                    this.updateExpenseCategories();
                },
                updateExpenseCategories() {
                    this.expenseCategories.forEach(category => {
                        category.amount = this.expenses
                            .filter(expense => expense.category === category.name)
                            .reduce((sum, expense) => sum + parseInt(expense.amount), 0);
                    });
                },
                
                // 購物清單方法
                saveShoppingItem() {
                    const newId = this.shoppingItems.length > 0 ? Math.max(...this.shoppingItems.map(i => i.id)) + 1 : 1;
                    this.shoppingItems.push({
                        id: newId,
                        completed: false,
                        ...this.newItem
                    });
                    this.showAddItem = false;
                },
                removeShoppingItem(id) {
                    this.shoppingItems = this.shoppingItems.filter(item => item.id !== id);
                },
                toggleItemComplete(id) {
                    const item = this.shoppingItems.find(item => item.id === id);
                    if (item) {
                        item.completed = !item.completed;
                    }
                },
                
                // 主題設定
                applyTheme(theme) {
                    // 更新所有選項卡的顏色
                    this.tabs[0].color = theme.color1;
                    this.tabs[0].color2 = theme.color2;
                    this.showSettings = false;
                }
            },
            mounted() {
                this.updateExpenseCategories();
                
                // 初始化地圖
                if (window.google && window.google.maps) {
                    this.initMap();
                } else {
                    window.initMap = () => {
                        this.initMap();
                    };
                }
                
                // 設定預設時間格式
                this.newItinerary.time = '09:00';
                this.newExpense.date = this.getTodayDate();
            }
        }).mount('#app');
    </script>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    },
                    colors: {
                        pink: {
                            50: '#fdf2f8',
                            100: '#fce7f3',
                            200: '#fbcfe8',
                            300: '#f9a8d4',
                            400: '#f472b6',
                            500: '#ec4899',
                            600: '#db2777',
                            700: '#be185d',
                            800: '#9d174d',
                            900: '#831843',
                        },
                        purple: {
                            50: '#faf5ff',
                            100: '#f3e8ff',
                            200: '#e9d5ff',
                            300: '#d8b4fe',
                            400: '#c084fc',
                            500: '#a855f7',
                            600: '#9333ea',
                            700: '#7e22ce',
                            800: '#6b21a8',
                            900: '#581c87',
                        },
                        blue: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>
</body>
</html>